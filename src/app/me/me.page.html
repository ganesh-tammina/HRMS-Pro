<ion-header [translucent]="true">
  <!-- <app-header></app-header> -->
  <app-employee-header></app-employee-header>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-grid class="ion-no-padding">
    <div class="dashboard">
      <ion-row class="attendance-block">
        <ion-col size="4">
          <!-- Attendance Stats -->
          <ion-card class="attendance-stats">
            <ion-card-header>
              <ion-card-title>Attendance Stats</ion-card-title>
            </ion-card-header>

            <ion-card-content>
              Status: <strong>{{ status }}</strong><br>
              <ion-grid class="days-grid ion-no-padding">
                <ion-row>
                  <ion-col class="row-left">

                    <img src="../../assets/user.svg" width="25">
                    <p class="pl-5"> Me</p>

                  </ion-col>
                  <ion-col>
                    <div>
                      <p> Gross Hours:</p>
                      <p> <strong>{{ grossHours }}</strong></p>
                    </div>
                  </ion-col>
                  <ion-col>
                    <div>
                      <p> Effective Hours:</p>
                      <p> <strong>{{ effectiveHours }}</strong></p>
                    </div>
                  </ion-col>
                </ion-row>
              </ion-grid>

            </ion-card-content>
          </ion-card>
        </ion-col>

        <ion-col size="4">
          <!-- Timings -->
          <ion-card class="timings-card">
            <ion-card-header>
              <ion-card-title>Timings</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-grid class="days-grid ion-no-padding mb-30">
                <ion-row>
                  <ion-col *ngFor="let day of days" class="ion-text-center">
                    <div class="day-container" [ngClass]="{'highlight-today': isToday(day)}">
                      <p class="day-of-week">{{ day | date:'E' }}</p>
                    </div>
                  </ion-col>
                </ion-row>
              </ion-grid>

              <p>Today (9:30 AM - 6:30 PM)</p>

              <ion-progress-bar value="0.85"></ion-progress-bar>

              <small>Duration: 9h 0m | Break: 60m</small>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <ion-col size="4">

          <ion-card class="actions">
            <ion-card-header>
              <ion-card-title>Actions</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <!-- Actions -->
              <ion-row class="actions-card">
                <ion-col size="4">
                  <h5 class="clock">{{ currentTime }}</h5>
                  <div class="info">{{ currentDate }}</div>
                </ion-col>

                <ion-col size="6">
                  <app-clock-button></app-clock-button>
                  <div class="info m-5 ion-text-center" *ngIf="record?.isClockedIn">
                    Since Last Login: {{ timeSinceLastLogin }}
                  </div>
                  <ion-button fill="clear" class="clear" *ngIf="!record?.isClockedIn">
                    <img src="../../assets/Icons/attendance-icons/remote.svg" width="16" height="16">
                    Remote Clock-In
                  </ion-button>
                  <ion-button fill="clear" class="clear" *ngIf="!record?.isClockedIn">
                    <img src="../../assets/Icons/attendance-icons/wfh clockin.svg" width="16" height="16">
                    WFH Clock-In
                  </ion-button>
                  <ion-button fill="clear" class="clear">
                    <img src="../../assets/Icons/attendance-icons/WFH.svg" width="16" height="16">
                    Work From Home
                  </ion-button>
                  <ion-button fill="clear" class="clear">
                    <img src="../../assets/Icons/attendance-icons/partial day rq.svg" width="16" height="16">
                    Partial Day Request
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>




    </div>
  </ion-grid>

  <div class="attendance-log-card">
    <h2>Logs & Requests</h2>
    <!-- logs & request Tabs -->
    <div class="tabs-container custom-tabs">
      <button [class.active]="activeTab === 'log'" (click)="setTab('log')">Attendance Log</button>
      <button [class.active]="activeTab === 'calendar'" (click)="setTab('calendar')">Calendar</button>
      <button [class.active]="activeTab === 'requests'" (click)="setTab('requests')">Attendance Requests</button>
    </div>
<!-- Attedance Log Tab -->
    <div *ngIf="activeTab === 'log'">

      <!-- Filters -->
      <div class="row-space-between">
        <div>
          <p>Last 30 Days</p>
        </div>
        <div class="filters">
          <div class="filter-block">
            <button class="btn-secondry active">30 DAYS</button>
            <button class="btn-secondry">AUG</button>
            <button class="btn-secondry">JUL</button>
            <button class="btn-secondry">JUN</button>
            <button class="btn-secondry">MAY</button>
            <button class="btn-secondry">APR</button>
            <button class="btn-secondry">MAR</button>
          </div>
        </div>
      </div>


      <!-- Table -->
      <ion-grid class="attendance-table">
        <ion-row class="table-header">
          <ion-col size="2">Date</ion-col>
          <ion-col size="3">Attendance Visual</ion-col>
          <ion-col size="2">Effective Hours</ion-col>
          <ion-col size="2">Gross Hours</ion-col>
          <ion-col size="2">Arrival</ion-col>
          <ion-col size="1">Log</ion-col>
        </ion-row>

        <ion-row *ngFor="let log of attendanceLogs" class="table-row">
          <ion-col size="2">{{ currentDate }}</ion-col>
          <ion-col size="3">
            <ion-progress-bar [value]="log.progress"></ion-progress-bar>
          </ion-col>
          <ion-col size="2">{{ effectiveHours }}</ion-col>
          <ion-col size="2">
            {{ grossHours }}
          </ion-col>
          <ion-col size="2">
            <ion-icon name="checkmark-outline" color="success"></ion-icon>
            {{ log.arrival }}
          </ion-col>
          <ion-col size="1">
            <ion-icon id="popover-button" name="alert-circle-outline" color="warning" (click)="openLogDetails(log)">
            </ion-icon>
          </ion-col>
        </ion-row>
        <ion-popover *ngIf="showPopover" [isOpen]="showPopover" trigger="popover-button" [dismissOnSelect]="false">
          <ng-template>
            <ion-content class="popover-content ion-padding">
              <p class="card-title">Day Shift 1( {{ currentDate }})</p>
              <p class="card-title">{{ selectedLog?.details?.shiftTime }}</p>
              <p class="divider"></p>
              <p><strong>Location:</strong></p>
              <p class="card-title">{{ selectedLog?.details?.location }}</p>
              <ion-row class="ion-no-padding">
                <ion-col *ngFor="let event of history" class="clock-logs" size="6">
                  <div class="d-flex">
                    <p *ngIf="event.type === 'CLOCK_IN'"><img src="../../assets/Icons/clock-in.svg" width="12"> {{
                      event.displayTime }}</p>
                    <p *ngIf="event.type !== 'CLOCK_IN'"><img src="../../assets/Icons/clock-out.svg" width="12">{{
                      event.displayTime }}</p>

                  </div>
                </ion-col>
              </ion-row>
            </ion-content>
          </ng-template>
        </ion-popover>

        <!-- Weekly off row -->
        <ion-row class="table-row weekoff-row">
          <ion-col size="2">Sun, 31 Aug<label>W-OFF</label></ion-col>
          <ion-col size="10" class="text-center">Full day Weekly-off</ion-col>

        </ion-row>
        <ion-row class="table-row weekoff-row">
          <ion-col size="2">Sun, 31 Aug<label>W-OFF</label></ion-col>
          <ion-col size="10" class="text-center">Full day Weekly-off</ion-col>

        </ion-row>

      </ion-grid>
    </div>
<!-- Calendar Tab -->
    <div *ngIf="activeTab === 'calendar'">
      <div class="calendar-container">
        <div class="row-space-between">
          <div class="calendar-header">
            <button (click)="prevMonth()"><ion-icon name="chevron-back-outline"></ion-icon></button>
            <span>{{ currentMonth | date: 'MMMM yyyy' }}</span>
            <button (click)="nextMonth()"><ion-icon name="chevron-forward-outline"></ion-icon></button>
          </div>
          <div class="filters">
            <div class="filter-block">
              <button class="btn-secondry active">SEP</button>
              <button class="btn-secondry">OCT</button>
              <button class="btn-secondry">NOV</button>
              <button class="btn-secondry">DEC</button>
              <button class="btn-secondry">JAN</button>
              <button class="btn-secondry">FEB</button>
              <button class="btn-secondry">MAR</button>
            </div>
          </div>
        </div>
        <div class="calendar-grid">

          <div class="day-header">
            <button class="day-header-cell" *ngFor="let day of weekDays">{{ day }}</button>
          </div>
          <div class="day-cell-row">
            <div class="day-cell" *ngFor="let date of calendarDays"
              [ngClass]="{'highlight-today': isTodayCalendarDay(date)}">
              <div class="date">{{ date.day }}</div>
              <div class="timing" *ngIf="date.timing">{{ date.timing }}</div>
              <div class="timing" *ngIf="date.isOff">W-OFF</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
   <!-- Attendance Requests Tab -->

<div *ngIf="activeTab === 'requests'">
  <div *ngFor="let reqGroup of attendanceRequestsHistory" class="request-card">
    <ion-card>
      <ion-card-header>
        <ion-card-title>{{ reqGroup.type }}</ion-card-title>
        <ion-card-subtitle>{{ reqGroup.dateRange }}</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <!-- Check if this group's records are empty -->
        <ng-container *ngIf="reqGroup.records.length > 0; else noRequests">
          <ion-grid class="requests-table">
            <ion-row class="table-header">
              <ion-col size="2">Date</ion-col>
              <ion-col size="2">Request</ion-col>
              <ion-col size="2">Requested On</ion-col>
              <ion-col size="2">Note</ion-col>
              <ion-col size="1">Reason</ion-col>
              <ion-col size="1">Status</ion-col>
              <ion-col size="2">Last Action</ion-col>
              <ion-col size="2">Next Approver</ion-col>
            </ion-row>

            <ion-row *ngFor="let record of reqGroup.records" class="table-row">
              <ion-col size="2">{{ record.date }}</ion-col>
              <ion-col size="2">{{ record.request }}</ion-col>
              <ion-col size="2">{{ record.requestedOn }}</ion-col>
              <ion-col size="2">{{ record.note }}</ion-col>
              <ion-col size="1">{{ record.reason || '-' }}</ion-col>
              <ion-col size="1">
                <span class="status" [ngClass]="record.status.toLowerCase()">
                  {{ record.status }}
                </span>
              </ion-col>
              <ion-col size="2">{{ record.lastAction }}</ion-col>
              <ion-col size="2">{{ record.nextApprover || '-' }}</ion-col>
            </ion-row>
          </ion-grid>
        </ng-container>

        <!-- Show "No Requests" message -->
        <ng-template #noRequests>
          <ion-item color="light">
            <ion-label>No {{ reqGroup.type }} Available.</ion-label>
          </ion-item>
        </ng-template>
      </ion-card-content>
    </ion-card>
  </div>
</div>


  </div>
</ion-content>